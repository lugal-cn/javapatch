$.fn.zSign=function(n){var l=$.extend({img:"",width:120,height:120,offset:8,callBack:null},n||{});var j=$(this).addClass("zsign");var h={minX:l.offset,minY:l.offset,maxX:j.width()-l.width-l.offset-18,maxY:j.height()-l.height-l.offset-18};var m=$("<div class='panel'><button class='btn add' >盖 章</button><button class='btn cancel'>关 闭</button></div>").appendTo(j);var i="<div class='sign' style='height:"+l.height+"px;width:"+l.width+"px;top:"+l.offset+"px;left:"+l.offset+"px'><img src='"+l.img+"' draggable='false'/><button class='btn ok' >确定</button><button class='btn del' >删除</button></div>";var k=$(".add",m).click(function(a){k.attr("disabled","disabled");var b=$(i).appendTo(j);$(".ok",b).click(function(){b.addClass("ok").off("mousedown").find(".btn").remove();k.removeAttr("disabled");if(l.callBack){l.callBack.call(this,{img:l.img,top:parseInt(b.css("top")),left:parseInt(b.css("left"))})}});$(".del",b).click(function(){b.remove();k.removeAttr("disabled")});b.on("mousedown",function(c){b.data("x",c.clientX);b.data("y",c.clientY);var d=b.position();$(document).on("mousemove",function(e){var f=e.clientX-b.data("x")+d.left;var g=e.clientY-b.data("y")+d.top;f=f<h.minX?h.minX:f;f=f>h.maxX?h.maxX:f;g=g<h.minY?h.minY:g;g=g>h.maxY?h.maxY:g;b.css({left:f,top:g})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})})});$(".cancel",m).click(function(){var a=true;if(k.attr("disabled")=="disabled"){if(!confirm("未确定的盖章将被取消，确定要关闭吗？")){a=false}}if(a){$(".sign:not(.ok)",j).remove();m.remove()}})};