(function(){CKEDITOR.dialog.add("templates",function(p){function f(d,e){var b=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),a='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';d.image&&e&&(a+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(e+d.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>');a+='<td style="white-space:normal;"><span class="cke_tpl_title">'+d.title+"</span><br/>";d.description&&(a+="<span>"+d.description+"</span>");b.getFirst().setHtml(a+"</td></tr></table>");b.on("click",function(){h(d.html)});return b}function h(a){var b=CKEDITOR.dialog.getCurrent();b.getValueOf("selectTpl","chkInsertOpt")?(p.fire("saveSnapshot"),p.setData(a,function(){b.hide();var d=p.createRange();d.moveToElementEditStart(p.editable());d.select();setTimeout(function(){p.fire("saveSnapshot")},0)})):(p.insertHtml(a),b.hide())}function c(d){var e=d.data.getTarget(),j=l.equals(e);if(j||l.contains(e)){var k=d.data.getKeystroke(),b=l.getElementsByTag("a"),a;if(b){if(j){a=b.getItem(0)}else{switch(k){case 40:a=e.getNext();break;case 38:a=e.getPrevious();break;case 13:case 32:e.fire("click")}}a&&(a.focus(),d.data.preventDefault())}}}var o=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(o.path+"dialogs/templates.css"));var l,o="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),i=p.lang.templates,g=p.config;return{title:p.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:i.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+i.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+o+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+o+'">'+i.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:i.insertOption,"default":g.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var a=this.getContentElement("selectTpl","templatesList");l=a.getElement();CKEDITOR.loadTemplates(g.templates_files,function(){var u=(g.templates||"default").split(",");if(u.length){var v=l;v.setHtml("");for(var b=0,e=u.length;b<e;b++){for(var d=CKEDITOR.getTemplates(u[b]),j=d.imagesPath,d=d.templates,n=d.length,k=0;k<n;k++){var m=f(d[k],j);m.setAttribute("aria-posinset",k+1);m.setAttribute("aria-setsize",n);v.append(m)}}a.focus()}else{l.setHtml('<div class="cke_tpl_empty"><span>'+i.emptyListMsg+"</span></div>")}});this._.element.on("keydown",c)},onHide:function(){this._.element.removeListener("keydown",c)}}})})();