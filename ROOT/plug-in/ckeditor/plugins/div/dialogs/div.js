(function(){function d(f,b,a){if(!b.is||!b.getCustomData("block_processed")){b.is&&CKEDITOR.dom.element.setMarker(a,b,"block_processed",!0),f.push(b)}}function c(l,k){function b(){this.foreach(function(e){if(/^(?!vbox|hbox)/.test(e.type)&&(e.setup||(e.setup=function(f){e.setValue(f.getAttribute(e.id)||"",1)}),!e.commit)){e.commit=function(f){var g=this.getValue();"dir"==e.id&&f.getComputedStyle("direction")==g||(g?f.setAttribute(e.id,g):f.removeAttribute(e.id))}}})}var a=function(){var e=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);l.config.div_wrapTable&&(delete e.td,delete e.th);return e}(),j=CKEDITOR.dtd.div,m={},n=[];return{title:l.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:l.lang.common.generalTab,title:l.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:l.lang.div.styleSelectLabel,"default":"",items:[[l.lang.common.notSet,""]],onChange:function(){var p=["info:elementStyle","info:class","advanced:dir","advanced:style"],i=this.getDialog(),f=i._element&&i._element.clone()||new CKEDITOR.dom.element("div",l.document);this.commit(f,!0);for(var p=[].concat(p),h=p.length,g,e=0;e<h;e++){(g=i.getContentElement.apply(i,p[e].split(":")))&&g.setup&&g.setup(f,!0)}},setup:function(f){for(var e in m){m[e].checkElementRemovable(f,!0)&&this.setValue(e,1)}},commit:function(f){var e;(e=this.getValue())?m[e].applyToObject(f):f.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:l.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:l.lang.common.advancedTab,title:l.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:l.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:l.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:l.lang.common.cssStyle,"default":"",commit:function(e){e.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:l.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:l.lang.common.langDir,"default":"",items:[[l.lang.common.notSet,""],[l.lang.common.langDirLtr,"ltr"],[l.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){b.call(this);var f=this,e=this.getContentElement("info","elementStyle");l.getStylesSet(function(p){var h,g;if(p){for(var i=0;i<p.length;i++){g=p[i],g.element&&"div"==g.element&&(h=g.name,m[h]=g=new CKEDITOR.style(g),l.filter.check(g)&&(e.items.push([h,h]),e.add(h,h)))}}e[1<e.items.length?"enable":"disable"]();setTimeout(function(){f._element&&e.setup(f._element)},0)})},onShow:function(){"editdiv"==k&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(l))},onOk:function(){if("editdiv"==k){n=[this._element]}else{var z=[],y={},h=[],x,i=l.getSelection(),e=i.getRanges(),w=i.createBookmarks(),g,v;for(g=0;g<e.length;g++){for(v=e[g].createIterator();x=v.getNextParagraph();){if(x.getName() in a){var f=x.getChildren();for(x=0;x<f.count();x++){d(h,f.getItem(x),y)}}else{for(;!j[x.getName()]&&!x.equals(e[g].root);){x=x.getParent()}d(h,x,y)}}}CKEDITOR.dom.element.clearAllMarkers(y);e=[];g=null;for(v=0;v<h.length;v++){x=h[v],f=l.elementPath(x).blockLimit,l.config.div_wrapTable&&f.is(["td","th"])&&(f=l.elementPath(f.getParent()).blockLimit),f.equals(g)||(g=f,e.push([])),e[e.length-1].push(x)}for(g=0;g<e.length;g++){f=e[g][0];h=f.getParent();for(x=1;x<e[g].length;x++){h=h.getCommonAncestor(e[g][x])}v=new CKEDITOR.dom.element("div",l.document);for(x=0;x<e[g].length;x++){for(f=e[g][x];!f.getParent().equals(h);){f=f.getParent()}e[g][x]=f}for(x=0;x<e[g].length;x++){if(f=e[g][x],!f.getCustomData||!f.getCustomData("block_processed")){f.is&&CKEDITOR.dom.element.setMarker(y,f,"block_processed",!0),x||v.insertBefore(f),v.append(f)}}CKEDITOR.dom.element.clearAllMarkers(y);z.push(v)}i.selectBookmarks(w);n=z}z=n.length;for(y=0;y<z;y++){this.commitContent(n[y]),!n[y].getAttribute("style")&&n[y].removeAttribute("style")}this.hide()},onHide:function(){"editdiv"==k&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(a){return c(a,"creatediv")});CKEDITOR.dialog.add("editdiv",function(a){return c(a,"editdiv")})})();