CKEDITOR.dialog.add("select",function(m){function f(e,o,d,b,a){e=n(e);b=b?b.createElement("OPTION"):document.createElement("OPTION");if(e&&b&&"option"==b.getName()){CKEDITOR.env.ie?(isNaN(parseInt(a,10))?e.$.options.add(b.$):e.$.options.add(b.$,a),b.$.innerHTML=0<o.length?o:"",b.$.value=d):(null!==a&&a<e.getChildCount()?e.getChild(0>a?0:a).insertBeforeMe(b):e.append(b),b.setText(0<o.length?o:""),b.setValue(d))}else{return !1}return b}function k(b){for(var b=n(b),d=c(b),a=b.getChildren().count()-1;0<=a;a--){b.getChild(a).$.selected&&b.getChild(a).remove()}g(b,d)}function l(d,e,b,a){d=n(d);if(0>e){return !1}d=d.getChild(e);d.setText(b);d.setValue(a);return d}function i(a){for(a=n(a);a.getChild(0)&&a.getChild(0).remove();){}}function h(o,p,e){var o=n(o),b=c(o);if(0>b){return !1}p=b+p;p=0>p?0:p;p=p>=o.getChildCount()?o.getChildCount()-1:p;if(b==p){return !1}var b=o.getChild(b),a=b.getText(),d=b.getValue();b.remove();b=f(o,a,d,!e?null:e,p);g(o,p);return b}function c(a){return(a=n(a))?a.$.selectedIndex:-1}function g(b,d){b=n(b);if(0>d){return null}var a=b.getChildren().count();b.$.selectedIndex=d>=a?a-1:d;return b}function j(a){return(a=n(a))?a.getChildren():!1}function n(a){return a&&a.domId&&a.getInputElement().$?a.getInputElement():a&&a.$?a:!1}return{title:m.lang.forms.select.title,minWidth:CKEDITOR.env.ie?460:395,minHeight:CKEDITOR.env.ie?320:300,onShow:function(){delete this.selectBox;this.setupContent("clear");var a=this.getParentEditor().getSelection().getSelectedElement();if(a&&"select"==a.getName()){this.selectBox=a;this.setupContent(a.getName(),a);for(var a=j(a),b=0;b<a.count();b++){this.setupContent("option",a.getItem(b))}}},onOk:function(){var e=this.getParentEditor(),o=this.selectBox,d=!o;d&&(o=e.document.createElement("select"));this.commitContent(o);if(d&&(e.insertElement(o),CKEDITOR.env.ie)){var b=e.getSelection(),a=b.createBookmarks();setTimeout(function(){b.selectBookmarks(a)},0)}},contents:[{id:"info",label:m.lang.forms.select.selectInfo,title:m.lang.forms.select.selectInfo,accessKey:"",elements:[{id:"txtName",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:m.lang.common.name,"default":"",accessKey:"N",style:"width:350px",setup:function(a,b){"clear"==a?this.setValue(this["default"]||""):"select"==a&&this.setValue(b.data("cke-saved-name")||b.getAttribute("name")||"")},commit:function(a){this.getValue()?a.data("cke-saved-name",this.getValue()):(a.data("cke-saved-name",!1),a.removeAttribute("name"))}},{id:"txtValue",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:m.lang.forms.select.value,style:"width:350px","default":"",className:"cke_disabled",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)},setup:function(a,b){"clear"==a?this.setValue(""):"option"==a&&b.getAttribute("selected")&&this.setValue(b.$.value)}},{type:"hbox",widths:["175px","170px"],children:[{id:"txtSize",type:"text",labelLayout:"horizontal",label:m.lang.forms.select.size,"default":"",accessKey:"S",style:"width:175px",validate:function(){var a=CKEDITOR.dialog.validate.integer(m.lang.common.validateNumberFailed);return""===this.getValue()||a.apply(this)},setup:function(a,b){"select"==a&&this.setValue(b.getAttribute("size")||"");CKEDITOR.env.webkit&&this.getInputElement().setStyle("width","86px")},commit:function(a){this.getValue()?a.setAttribute("size",this.getValue()):a.removeAttribute("size")}},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(m.lang.forms.select.lines)+"</span>"}]},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(m.lang.forms.select.opAvail)+"</span>"},{type:"hbox",widths:["115px","115px","100px"],children:[{type:"vbox",children:[{id:"txtOptName",type:"text",label:m.lang.forms.select.opText,style:"width:115px",setup:function(a){"clear"==a&&this.setValue("")}},{type:"select",id:"cmbName",label:"",title:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var d=this.getDialog(),e=d.getContentElement("info","cmbValue"),b=d.getContentElement("info","txtOptName"),d=d.getContentElement("info","txtOptValue"),a=c(this);g(e,a);b.setValue(this.getValue());d.setValue(e.getValue())},setup:function(a,b){"clear"==a?i(this):"option"==a&&f(this,b.getText(),b.getText(),this.getDialog().getParentEditor().document)},commit:function(o){var p=this.getDialog(),b=j(this),a=j(p.getContentElement("info","cmbValue")),q=p.getContentElement("info","txtValue").getValue();i(o);for(var d=0;d<b.count();d++){var e=f(o,b.getItem(d).getValue(),a.getItem(d).getValue(),p.getParentEditor().document);a.getItem(d).getValue()==q&&(e.setAttribute("selected","selected"),e.selected=!0)}}}]},{type:"vbox",children:[{id:"txtOptValue",type:"text",label:m.lang.forms.select.opValue,style:"width:115px",setup:function(a){"clear"==a&&this.setValue("")}},{type:"select",id:"cmbValue",label:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var d=this.getDialog(),e=d.getContentElement("info","cmbName"),b=d.getContentElement("info","txtOptName"),d=d.getContentElement("info","txtOptValue"),a=c(this);g(e,a);b.setValue(e.getValue());d.setValue(this.getValue())},setup:function(b,d){if("clear"==b){i(this)}else{if("option"==b){var a=d.getValue();f(this,a,a,this.getDialog().getParentEditor().document);"selected"==d.getAttribute("selected")&&this.getDialog().getContentElement("info","txtValue").setValue(a)}}}}]},{type:"vbox",padding:5,children:[{type:"button",id:"btnAdd",style:"",label:m.lang.forms.select.btnAdd,title:m.lang.forms.select.btnAdd,style:"width:100%;",onClick:function(){var e=this.getDialog();e.getParentEditor();var o=e.getContentElement("info","txtOptName"),d=e.getContentElement("info","txtOptValue"),b=e.getContentElement("info","cmbName"),a=e.getContentElement("info","cmbValue");f(b,o.getValue(),o.getValue(),e.getParentEditor().document);f(a,d.getValue(),d.getValue(),e.getParentEditor().document);o.setValue("");d.setValue("")}},{type:"button",id:"btnModify",label:m.lang.forms.select.btnModify,title:m.lang.forms.select.btnModify,style:"width:100%;",onClick:function(){var e=this.getDialog(),o=e.getContentElement("info","txtOptName"),d=e.getContentElement("info","txtOptValue"),b=e.getContentElement("info","cmbName"),e=e.getContentElement("info","cmbValue"),a=c(b);0<=a&&(l(b,a,o.getValue(),o.getValue()),l(e,a,d.getValue(),d.getValue()))}},{type:"button",id:"btnUp",style:"width:100%;",label:m.lang.forms.select.btnUp,title:m.lang.forms.select.btnUp,onClick:function(){var b=this.getDialog(),d=b.getContentElement("info","cmbName"),a=b.getContentElement("info","cmbValue");h(d,-1,b.getParentEditor().document);h(a,-1,b.getParentEditor().document)}},{type:"button",id:"btnDown",style:"width:100%;",label:m.lang.forms.select.btnDown,title:m.lang.forms.select.btnDown,onClick:function(){var b=this.getDialog(),d=b.getContentElement("info","cmbName"),a=b.getContentElement("info","cmbValue");h(d,1,b.getParentEditor().document);h(a,1,b.getParentEditor().document)}}]}]},{type:"hbox",widths:["40%","20%","40%"],children:[{type:"button",id:"btnSetValue",label:m.lang.forms.select.btnSetValue,title:m.lang.forms.select.btnSetValue,onClick:function(){var a=this.getDialog(),b=a.getContentElement("info","cmbValue");a.getContentElement("info","txtValue").setValue(b.getValue())}},{type:"button",id:"btnDelete",label:m.lang.forms.select.btnDelete,title:m.lang.forms.select.btnDelete,onClick:function(){var d=this.getDialog(),e=d.getContentElement("info","cmbName"),a=d.getContentElement("info","cmbValue"),b=d.getContentElement("info","txtOptName"),d=d.getContentElement("info","txtOptValue");k(e);k(a);b.setValue("");d.setValue("")}},{id:"chkMulti",type:"checkbox",label:m.lang.forms.select.chkMulti,"default":"",accessKey:"M",value:"checked",setup:function(a,b){"select"==a&&this.setValue(b.getAttribute("multiple"));CKEDITOR.env.webkit&&this.getElement().getParent().setStyle("vertical-align","middle")},commit:function(a){this.getValue()?a.setAttribute("multiple",this.getValue()):a.removeAttribute("multiple")}}]}]}]}});