CKEDITOR.dialog.add("specialchar",function(i){var e,l=i.lang.specialchar,k=function(a){var b,a=a.data?a.data.getTarget():new CKEDITOR.dom.element(a);if("a"==a.getName()&&(b=a.getChild(0).getHtml())){a.removeClass("cke_light_background"),e.hide(),a=i.document.createElement("span"),a.setHtml(b),i.insertText(a.getText())}},m=CKEDITOR.tools.addFunction(k),j,g=function(a,f){var c,f=f||a.data.getTarget();"span"==f.getName()&&(f=f.getParent());if("a"==f.getName()&&(c=f.getChild(0).getHtml())){j&&d(null,j);var b=e.getContentElement("info","htmlPreview").getElement();e.getContentElement("info","charPreview").getElement().setHtml(c);b.setHtml(CKEDITOR.tools.htmlEncode(c));f.getParent().addClass("cke_light_background");j=f}},d=function(a,b){b=b||a.data.getTarget();"span"==b.getName()&&(b=b.getParent());"a"==b.getName()&&(e.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),e.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),b.getParent().removeClass("cke_light_background"),j=void 0)},n=CKEDITOR.tools.addFunction(function(a){var a=new CKEDITOR.dom.event(a),f=a.getTarget(),c;c=a.getKeystroke();var b="rtl"==i.lang.dir;switch(c){case 38:if(c=f.getParent().getParent().getPrevious()){c=c.getChild([f.getParent().getIndex(),0]),c.focus(),d(null,f),g(null,c)}a.preventDefault();break;case 40:if(c=f.getParent().getParent().getNext()){if((c=c.getChild([f.getParent().getIndex(),0]))&&1==c.type){c.focus(),d(null,f),g(null,c)}}a.preventDefault();break;case 32:k({data:a});a.preventDefault();break;case b?37:39:if(c=f.getParent().getNext()){c=c.getChild(0),1==c.type?(c.focus(),d(null,f),g(null,c),a.preventDefault(!0)):d(null,f)}else{if(c=f.getParent().getParent().getNext()){(c=c.getChild([0,0]))&&1==c.type?(c.focus(),d(null,f),g(null,c),a.preventDefault(!0)):d(null,f)}}break;case b?39:37:(c=f.getParent().getPrevious())?(c=c.getChild(0),c.focus(),d(null,f),g(null,c),a.preventDefault(!0)):(c=f.getParent().getParent().getPrevious())?(c=c.getLast().getChild(0),c.focus(),d(null,f),g(null,c),a.preventDefault(!0)):d(null,f)}});return{title:l.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var p=this.definition.charColumns,o=i.config.specialChars,h=CKEDITOR.tools.getNextId()+"_specialchar_table_label",y=['<table role="listbox" aria-labelledby="'+h+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],q=0,a=o.length,b,r;q<a;){y.push('<tr role="presentation">');for(var c=0;c<p;c++,q++){if(b=o[q]){b instanceof Array?(r=b[1],b=b[0]):(r=b.replace("&","").replace(";","").replace("#",""),r=l[r]||b);var f="cke_specialchar_label_"+q+"_"+CKEDITOR.tools.getNextNumber();y.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(q+1)+'"',' aria-setsize="'+a+'"',' aria-labelledby="'+f+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(r),'" onkeydown="CKEDITOR.tools.callFunction( '+n+', event, this )" onclick="CKEDITOR.tools.callFunction('+m+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+b+'</span><span class="cke_voice_label" id="'+f+'">'+r+"</span></a>")}else{y.push('<td class="cke_dark_background">&nbsp;')}y.push("</td>")}y.push("</tr>")}y.push("</tbody></table>",'<span id="'+h+'" class="cke_voice_label">'+l.options+"</span>");this.getContentElement("info","charContainer").getElement().setHtml(y.join(""))},contents:[{id:"info",label:i.lang.common.generalTab,title:i.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:g,onMouseout:d,focus:function(){var a=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){a.focus();g(null,a)},0)},onShow:function(){var a=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){a.focus();g(null,a)},0)},onLoad:function(a){e=a.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}});